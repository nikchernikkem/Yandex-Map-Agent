# Yandex-Map-Agent

Проект по созданию LLM‑агента, который оценивает релевантность организаций на Яндекс.Картах широким рубричным запросам (например, «ресторан с верандой» или «романтичный джаз‑бар»). Агент должен сам находить необходимые данные и принимать решение о релевантности.

Данные предоставлены Яндексом и содержат ассессорскую разметку релевантности.

**Что внутри**
1. Агент на LangGraph с LLM через OpenAI‑compatible API.
1. Инструмент поиска Tavily.
1. FAISS‑ретривер примеров на эмбеддингах `ai-forever/FRIDA`.
1. Базовый скрипт TF‑IDF + CatBoost.

**План работы**
1. Сделать сильный бейзлайн: один LLM‑запрос с few‑shot примерами или обучение трансформера на классификацию.
1. Разобраться с LangGraph и собрать каркас агента.
1. Реализовать агента, который может обращаться к поисковой строке для уточнения ответа.
1. Итеративно улучшать промпт, анализируя ошибки на train.
1. Опционально:
- ретривал похожих размеченных примеров из train;
- инструмент парсинга сайтов как tool для агента.

**Система оценивания**
1. Бейзлайн без агента (LLM допустим) — 2 балла.
1. Агент с возможностью обращения к поиску — 4 балла.
1. Существенно обогнать бейзлайн (или честно показать отсутствие прироста от агента) — 4 балла.
1. Опционально реализовать доп. идею — бонус.

**Данные и постановка**
- Цель: предсказать `relevance` по всем остальным полям организации.
- Метки: `1.0` = `RELEVANT_PLUS`, `0.1` = `RELEVANT_MINUS`, `0.0` = `IRRELEVANT`.
- Метрика: `accuracy` (классы сбалансированы).
- Eval‑множество: 500 объектов, без класса `RELEVANT_MINUS` для простоты.
- Важно: не использовать eval для калибровки/подбора промпта или параметров. Это делается только на train.

**Материалы**
- Статья: https://habr.com/ru/articles/864646/
- Видео: https://www.youtube.com/watch?v=U6LbW2IFUQw
- Данные: https://disk.yandex.ru/d/6d5hFHvpAZjQdw

**Быстрый старт**
1. Установите зависимости проекта (любым удобным способом).
1. Скопируйте переменные окружения:

```bash
cp .env.example .env
```

3. Заполните ключи в `.env`.
4. Запустите агента:

```bash
python src/agent.py
```

**Переменные окружения**
- `OPENAI_BASE_URL` — base URL для OpenAI‑compatible API.
- `OPENAI_API_KEY` — ключ для модели.
- `TAVILY_API_KEY` — ключ для Tavily Search.

**Данные и артефакты**
- `data/artifacts/faiss.index` и `data/artifacts/faiss_meta.json` — индекс и метаданные для retriever.
- `data/artifacts/val.jsonl` — валидация для baseline.
- `data/raw/` — исходные данные.

**Скрипты**
Запуск baseline:

```bash
python src/scripts/baseline_tfidf_catboost.py --train-path data/raw/data_final_for_dls_new.jsonl --val-path data/artifacts/val.jsonl
```

**Структура**
- `src/agent.py` — граф агента и запуск LLM.
- `src/tools.py` — инструменты (Tavily + FAISS‑retriever).
- `src/faiss_retriever.py` — логика ретривера.
- `src/scripts/baseline_tfidf_catboost.py` — baseline классификации.
